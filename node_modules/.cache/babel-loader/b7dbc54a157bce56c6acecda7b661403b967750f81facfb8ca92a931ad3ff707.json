{"ast":null,"code":"import{useCallback,useContext,useState}from\"react\";import{EquipmentType,initEquipment}from\"../../../utils/types\";import axios from\"axios\";import'./GoodList.css';import{UpdateMyEquipmentsContext}from\"../../../utils/use-my-equipments-contents\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Edit(_ref){let{equipment,add=false}=_ref;const[good,setGood]=useState(add?initEquipment:equipment);const[error,setError]=useState({});const[startAdd,setStartAdd]=useState(false);const updateMyEquipments=useContext(UpdateMyEquipmentsContext);const onChange=(field,e)=>{setGood({...good,[field]:e.target.value});};const onEdit=useCallback(e=>{e.preventDefault();const validateResult=validate(good);setError(validateResult);if(!!Object.keys(validateResult).length){return;}axios.patch(\"https://api.github.com/repos/popopoweork/camp-tool/issues/comments/\".concat(good.id),{body:JSON.stringify(good)},{headers:{Accept:\"application/vnd.github+json\",Authorization:\"Bearer \".concat(process.env.REACT_APP_ISSUE_TOKEN),\"X-GitHub-Api-Version\":\"2022-11-28\",\"Access-Control-Allow-Origin\":\"*\",\"Access-Control-Allow-Headers\":\"X-Requested-With\"}}).catch(e=>{alert(\"save error\");console.log(e);}).then(r=>{setStartAdd(false);updateMyEquipments();});},[good,updateMyEquipments]);const onSave=useCallback(e=>{e.preventDefault();const validateResult=validate(good);console.log(validateResult);setError(validateResult);if(!!Object.keys(validateResult).length){return;}axios.post(\"https://api.github.com/repos/popopoweork/camp-tool/issues/1/comments\",{body:JSON.stringify(good)},{headers:{Accept:\"application/vnd.github+json\",Authorization:\"Bearer \".concat(process.env.REACT_APP_ISSUE_TOKEN),\"X-GitHub-Api-Version\":\"2022-11-28\"}}).catch(e=>{alert(\"save error\");console.log(e);}).then(r=>{setStartAdd(false);updateMyEquipments();});},[good,updateMyEquipments]);return startAdd?/*#__PURE__*/_jsxs(\"div\",{className:\"good-row  good-add-row\",children:[/*#__PURE__*/_jsx(\"div\",{children:add?'-':good.id}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"input\",{value:good.name,onChange:v=>onChange(\"name\",v)}),error[\"name\"]&&/*#__PURE__*/_jsx(\"span\",{className:\"error\",children:error[\"name\"]})]}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"select\",{onChange:v=>onChange(\"type\",v),children:Object.keys(EquipmentType).map(v=>/*#__PURE__*/_jsx(\"option\",{value:v,children:v},v))})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:good.amount,onChange:v=>onChange(\"amount\",v)}),error[\"amount\"]&&/*#__PURE__*/_jsx(\"span\",{className:\"error\",children:error[\"amount\"]})]}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"input\",{value:good.memo,onChange:v=>onChange(\"memo\",v)})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"button\",{onClick:add?onSave:onEdit,children:\"Save\"})})]}):add?/*#__PURE__*/_jsx(\"div\",{className:\"good-add-button\",children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>setStartAdd(true),children:\"Add\"})}):/*#__PURE__*/_jsxs(\"div\",{className:\"good-row\",children:[/*#__PURE__*/_jsx(\"div\",{children:good.id}),/*#__PURE__*/_jsx(\"div\",{children:good.name}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"select\",{onChange:v=>{},disabled:true,value:good.type,children:Object.keys(EquipmentType).map(v=>/*#__PURE__*/_jsx(\"option\",{value:v,children:v},v))})}),/*#__PURE__*/_jsx(\"div\",{children:good.amount}),/*#__PURE__*/_jsx(\"div\",{children:good.memo}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>setStartAdd(true),children:\"Edit\"})})]});}export default Edit;function validate(good){const error={};if(!good.name.length)error[\"name\"]=\"name can not be empty\";if(good.amount<1)error[\"amount\"]=\"amount should be greater than 0\";return error;}","map":{"version":3,"names":["useCallback","useContext","useState","EquipmentType","initEquipment","axios","UpdateMyEquipmentsContext","jsx","_jsx","jsxs","_jsxs","Edit","_ref","equipment","add","good","setGood","error","setError","startAdd","setStartAdd","updateMyEquipments","onChange","field","e","target","value","onEdit","preventDefault","validateResult","validate","Object","keys","length","patch","concat","id","body","JSON","stringify","headers","Accept","Authorization","process","env","REACT_APP_ISSUE_TOKEN","catch","alert","console","log","then","r","onSave","post","className","children","name","v","map","type","amount","memo","onClick","disabled"],"sources":["/Users/bytedance/projects/camp-tool/src/pages/goods/components/Edit.tsx"],"sourcesContent":["import {\n  Fragment,\n  useCallback,\n  useContext,\n  useState,\n} from \"react\";\nimport {\n  Equipment,\n  EquipmentType,\n  FormError,\n  initEquipment,\n} from \"../../../utils/types\";\nimport axios from \"axios\";\nimport './GoodList.css'\nimport { UpdateMyEquipmentsContext } from \"../../../utils/use-my-equipments-contents\";\n\nfunction Edit({ equipment, add = false }: { equipment?: Equipment, add?: boolean }) {\n  const [good, setGood] = useState<Equipment>(add ? initEquipment : equipment!);\n  const [error, setError] = useState<FormError>({});\n  const [startAdd, setStartAdd] = useState(false);\n  const updateMyEquipments = useContext(UpdateMyEquipmentsContext);\n  const onChange = (field: string, e: any) => {\n    setGood({ ...good, [field]: e.target.value });\n  };\n\n  const onEdit = useCallback(\n    (e: any) => {\n      e.preventDefault();\n      const validateResult = validate(good);\n      setError(validateResult);\n      if (!!Object.keys(validateResult).length) {\n        return;\n      }\n      axios.patch(\n        `https://api.github.com/repos/popopoweork/camp-tool/issues/comments/${good.id}`,\n        {\n          body: JSON.stringify(good),\n        },\n        {\n          headers: {\n            Accept: \"application/vnd.github+json\",\n            Authorization: `Bearer ${process.env.REACT_APP_ISSUE_TOKEN}`,\n            \"X-GitHub-Api-Version\": \"2022-11-28\",\n            \"Access-Control-Allow-Origin\":\"*\",\n            \"Access-Control-Allow-Headers\":\"X-Requested-With\"\n          },\n        }\n      ).catch(e => {\n        alert(\"save error\");\n        console.log(e);\n      }).then(r => {\n        setStartAdd(false)\n        updateMyEquipments()\n      });\n    },\n    [good, updateMyEquipments]\n  );\n  const onSave = useCallback(\n    (e: any) => {\n      e.preventDefault();\n      const validateResult = validate(good);\n      console.log(validateResult);\n      setError(validateResult);\n      if (!!Object.keys(validateResult).length) {\n        return;\n      }\n      axios.post(\n        \"https://api.github.com/repos/popopoweork/camp-tool/issues/1/comments\",\n        {\n          body: JSON.stringify(good),\n        },\n        {\n          headers: {\n            Accept: \"application/vnd.github+json\",\n            Authorization: `Bearer ${process.env.REACT_APP_ISSUE_TOKEN}`,\n            \"X-GitHub-Api-Version\": \"2022-11-28\",\n          },\n        }\n      ).catch(e => {\n        alert(\"save error\");\n        console.log(e);\n      }).then(r => {\n        setStartAdd(false)\n        updateMyEquipments()\n      });\n    },\n    [good, updateMyEquipments]\n  );\n  return (\n    startAdd ?\n      <div className=\"good-row  good-add-row\">\n        <div>{add ? '-' : good.id}</div>\n        <div>\n          <input\n            value={good.name}\n            onChange={(v) => onChange(\"name\", v)}\n          ></input>\n          {error[\"name\"] && (\n            <span className=\"error\">{error[\"name\"]}</span>\n          )}\n        </div>\n        <div>\n          <select onChange={(v) => onChange(\"type\", v)}>\n            {Object.keys(EquipmentType).map((v) => (\n              <option value={v} key={v}>{v}</option>\n            ))}\n          </select>\n        </div>\n        <div>\n          <input\n            type=\"number\"\n            value={good.amount}\n            onChange={(v) => onChange(\"amount\", v)}\n          ></input>\n           {error[\"amount\"] && (\n            <span className=\"error\">{error[\"amount\"]}</span>\n          )}\n        </div>\n        <div>\n          <input\n            value={good.memo}\n            onChange={(v) => onChange(\"memo\", v)}\n          ></input>\n        </div>\n        <div>\n          <button onClick={add ? onSave : onEdit}>Save</button>\n        </div>\n      </div>\n      : add ? <div className=\"good-add-button\">\n        <button onClick={() => setStartAdd(true)}>Add</button>\n      </div> :\n        <div className=\"good-row\">\n          <div>\n            {good.id}\n          </div>\n          <div>\n            {good.name}\n          </div>\n          <div>\n            <select onChange={(v) => { }} disabled value={good.type}>\n              {Object.keys(EquipmentType).map((v) => (\n                <option value={v} key={v}>{v}</option>\n              ))}\n            </select>\n          </div>\n          <div>\n            {good.amount}\n          </div>\n          <div>\n            {good.memo}\n          </div>\n          <div>\n            <button onClick={() => setStartAdd(true)}>Edit</button>\n          </div>\n        </div>\n  );\n}\n\nexport default Edit;\n\nfunction validate(good: Equipment) {\n  const error: FormError = {};\n  if (!good.name.length) error[\"name\"] = \"name can not be empty\";\n  if (good.amount<1) error[\"amount\"] = \"amount should be greater than 0\";\n  return error;\n}\n"],"mappings":"AAAA,OAEEA,WAAW,CACXC,UAAU,CACVC,QAAQ,KACH,OAAO,CACd,OAEEC,aAAa,CAEbC,aAAa,KACR,sBAAsB,CAC7B,MAAO,CAAAC,KAAK,KAAM,OAAO,CACzB,MAAO,gBAAgB,CACvB,OAASC,yBAAyB,KAAQ,2CAA2C,CAAC,OAAAC,GAAA,IAAAC,IAAA,gCAAAC,IAAA,IAAAC,KAAA,yBAEtF,QAAS,CAAAC,IAAIA,CAAAC,IAAA,CAAuE,IAAtE,CAAEC,SAAS,CAAEC,GAAG,CAAG,KAAgD,CAAC,CAAAF,IAAA,CAChF,KAAM,CAACG,IAAI,CAAEC,OAAO,CAAC,CAAGd,QAAQ,CAAYY,GAAG,CAAGV,aAAa,CAAGS,SAAU,CAAC,CAC7E,KAAM,CAACI,KAAK,CAAEC,QAAQ,CAAC,CAAGhB,QAAQ,CAAY,CAAC,CAAC,CAAC,CACjD,KAAM,CAACiB,QAAQ,CAAEC,WAAW,CAAC,CAAGlB,QAAQ,CAAC,KAAK,CAAC,CAC/C,KAAM,CAAAmB,kBAAkB,CAAGpB,UAAU,CAACK,yBAAyB,CAAC,CAChE,KAAM,CAAAgB,QAAQ,CAAGA,CAACC,KAAa,CAAEC,CAAM,GAAK,CAC1CR,OAAO,CAAC,CAAE,GAAGD,IAAI,CAAE,CAACQ,KAAK,EAAGC,CAAC,CAACC,MAAM,CAACC,KAAM,CAAC,CAAC,CAC/C,CAAC,CAED,KAAM,CAAAC,MAAM,CAAG3B,WAAW,CACvBwB,CAAM,EAAK,CACVA,CAAC,CAACI,cAAc,CAAC,CAAC,CAClB,KAAM,CAAAC,cAAc,CAAGC,QAAQ,CAACf,IAAI,CAAC,CACrCG,QAAQ,CAACW,cAAc,CAAC,CACxB,GAAI,CAAC,CAACE,MAAM,CAACC,IAAI,CAACH,cAAc,CAAC,CAACI,MAAM,CAAE,CACxC,OACF,CACA5B,KAAK,CAAC6B,KAAK,uEAAAC,MAAA,CAC6DpB,IAAI,CAACqB,EAAE,EAC7E,CACEC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAACxB,IAAI,CAC3B,CAAC,CACD,CACEyB,OAAO,CAAE,CACPC,MAAM,CAAE,6BAA6B,CACrCC,aAAa,WAAAP,MAAA,CAAYQ,OAAO,CAACC,GAAG,CAACC,qBAAqB,CAAE,CAC5D,sBAAsB,CAAE,YAAY,CACpC,6BAA6B,CAAC,GAAG,CACjC,8BAA8B,CAAC,kBACjC,CACF,CACF,CAAC,CAACC,KAAK,CAACtB,CAAC,EAAI,CACXuB,KAAK,CAAC,YAAY,CAAC,CACnBC,OAAO,CAACC,GAAG,CAACzB,CAAC,CAAC,CAChB,CAAC,CAAC,CAAC0B,IAAI,CAACC,CAAC,EAAI,CACX/B,WAAW,CAAC,KAAK,CAAC,CAClBC,kBAAkB,CAAC,CAAC,CACtB,CAAC,CAAC,CACJ,CAAC,CACD,CAACN,IAAI,CAAEM,kBAAkB,CAC3B,CAAC,CACD,KAAM,CAAA+B,MAAM,CAAGpD,WAAW,CACvBwB,CAAM,EAAK,CACVA,CAAC,CAACI,cAAc,CAAC,CAAC,CAClB,KAAM,CAAAC,cAAc,CAAGC,QAAQ,CAACf,IAAI,CAAC,CACrCiC,OAAO,CAACC,GAAG,CAACpB,cAAc,CAAC,CAC3BX,QAAQ,CAACW,cAAc,CAAC,CACxB,GAAI,CAAC,CAACE,MAAM,CAACC,IAAI,CAACH,cAAc,CAAC,CAACI,MAAM,CAAE,CACxC,OACF,CACA5B,KAAK,CAACgD,IAAI,CACR,sEAAsE,CACtE,CACEhB,IAAI,CAAEC,IAAI,CAACC,SAAS,CAACxB,IAAI,CAC3B,CAAC,CACD,CACEyB,OAAO,CAAE,CACPC,MAAM,CAAE,6BAA6B,CACrCC,aAAa,WAAAP,MAAA,CAAYQ,OAAO,CAACC,GAAG,CAACC,qBAAqB,CAAE,CAC5D,sBAAsB,CAAE,YAC1B,CACF,CACF,CAAC,CAACC,KAAK,CAACtB,CAAC,EAAI,CACXuB,KAAK,CAAC,YAAY,CAAC,CACnBC,OAAO,CAACC,GAAG,CAACzB,CAAC,CAAC,CAChB,CAAC,CAAC,CAAC0B,IAAI,CAACC,CAAC,EAAI,CACX/B,WAAW,CAAC,KAAK,CAAC,CAClBC,kBAAkB,CAAC,CAAC,CACtB,CAAC,CAAC,CACJ,CAAC,CACD,CAACN,IAAI,CAAEM,kBAAkB,CAC3B,CAAC,CACD,MACE,CAAAF,QAAQ,cACNT,KAAA,QAAK4C,SAAS,CAAC,wBAAwB,CAAAC,QAAA,eACrC/C,IAAA,QAAA+C,QAAA,CAAMzC,GAAG,CAAG,GAAG,CAAGC,IAAI,CAACqB,EAAE,CAAM,CAAC,cAChC1B,KAAA,QAAA6C,QAAA,eACE/C,IAAA,UACEkB,KAAK,CAAEX,IAAI,CAACyC,IAAK,CACjBlC,QAAQ,CAAGmC,CAAC,EAAKnC,QAAQ,CAAC,MAAM,CAAEmC,CAAC,CAAE,CAC/B,CAAC,CACRxC,KAAK,CAAC,MAAM,CAAC,eACZT,IAAA,SAAM8C,SAAS,CAAC,OAAO,CAAAC,QAAA,CAAEtC,KAAK,CAAC,MAAM,CAAC,CAAO,CAC9C,EACE,CAAC,cACNT,IAAA,QAAA+C,QAAA,cACE/C,IAAA,WAAQc,QAAQ,CAAGmC,CAAC,EAAKnC,QAAQ,CAAC,MAAM,CAAEmC,CAAC,CAAE,CAAAF,QAAA,CAC1CxB,MAAM,CAACC,IAAI,CAAC7B,aAAa,CAAC,CAACuD,GAAG,CAAED,CAAC,eAChCjD,IAAA,WAAQkB,KAAK,CAAE+B,CAAE,CAAAF,QAAA,CAAUE,CAAC,EAALA,CAAc,CACtC,CAAC,CACI,CAAC,CACN,CAAC,cACN/C,KAAA,QAAA6C,QAAA,eACE/C,IAAA,UACEmD,IAAI,CAAC,QAAQ,CACbjC,KAAK,CAAEX,IAAI,CAAC6C,MAAO,CACnBtC,QAAQ,CAAGmC,CAAC,EAAKnC,QAAQ,CAAC,QAAQ,CAAEmC,CAAC,CAAE,CACjC,CAAC,CACPxC,KAAK,CAAC,QAAQ,CAAC,eACfT,IAAA,SAAM8C,SAAS,CAAC,OAAO,CAAAC,QAAA,CAAEtC,KAAK,CAAC,QAAQ,CAAC,CAAO,CAChD,EACE,CAAC,cACNT,IAAA,QAAA+C,QAAA,cACE/C,IAAA,UACEkB,KAAK,CAAEX,IAAI,CAAC8C,IAAK,CACjBvC,QAAQ,CAAGmC,CAAC,EAAKnC,QAAQ,CAAC,MAAM,CAAEmC,CAAC,CAAE,CAC/B,CAAC,CACN,CAAC,cACNjD,IAAA,QAAA+C,QAAA,cACE/C,IAAA,WAAQsD,OAAO,CAAEhD,GAAG,CAAGsC,MAAM,CAAGzB,MAAO,CAAA4B,QAAA,CAAC,MAAI,CAAQ,CAAC,CAClD,CAAC,EACH,CAAC,CACJzC,GAAG,cAAGN,IAAA,QAAK8C,SAAS,CAAC,iBAAiB,CAAAC,QAAA,cACtC/C,IAAA,WAAQsD,OAAO,CAAEA,CAAA,GAAM1C,WAAW,CAAC,IAAI,CAAE,CAAAmC,QAAA,CAAC,KAAG,CAAQ,CAAC,CACnD,CAAC,cACJ7C,KAAA,QAAK4C,SAAS,CAAC,UAAU,CAAAC,QAAA,eACvB/C,IAAA,QAAA+C,QAAA,CACGxC,IAAI,CAACqB,EAAE,CACL,CAAC,cACN5B,IAAA,QAAA+C,QAAA,CACGxC,IAAI,CAACyC,IAAI,CACP,CAAC,cACNhD,IAAA,QAAA+C,QAAA,cACE/C,IAAA,WAAQc,QAAQ,CAAGmC,CAAC,EAAK,CAAE,CAAE,CAACM,QAAQ,MAACrC,KAAK,CAAEX,IAAI,CAAC4C,IAAK,CAAAJ,QAAA,CACrDxB,MAAM,CAACC,IAAI,CAAC7B,aAAa,CAAC,CAACuD,GAAG,CAAED,CAAC,eAChCjD,IAAA,WAAQkB,KAAK,CAAE+B,CAAE,CAAAF,QAAA,CAAUE,CAAC,EAALA,CAAc,CACtC,CAAC,CACI,CAAC,CACN,CAAC,cACNjD,IAAA,QAAA+C,QAAA,CACGxC,IAAI,CAAC6C,MAAM,CACT,CAAC,cACNpD,IAAA,QAAA+C,QAAA,CACGxC,IAAI,CAAC8C,IAAI,CACP,CAAC,cACNrD,IAAA,QAAA+C,QAAA,cACE/C,IAAA,WAAQsD,OAAO,CAAEA,CAAA,GAAM1C,WAAW,CAAC,IAAI,CAAE,CAAAmC,QAAA,CAAC,MAAI,CAAQ,CAAC,CACpD,CAAC,EACH,CAAC,CAEd,CAEA,cAAe,CAAA5C,IAAI,CAEnB,QAAS,CAAAmB,QAAQA,CAACf,IAAe,CAAE,CACjC,KAAM,CAAAE,KAAgB,CAAG,CAAC,CAAC,CAC3B,GAAI,CAACF,IAAI,CAACyC,IAAI,CAACvB,MAAM,CAAEhB,KAAK,CAAC,MAAM,CAAC,CAAG,uBAAuB,CAC9D,GAAIF,IAAI,CAAC6C,MAAM,CAAC,CAAC,CAAE3C,KAAK,CAAC,QAAQ,CAAC,CAAG,iCAAiC,CACtE,MAAO,CAAAA,KAAK,CACd"},"metadata":{},"sourceType":"module","externalDependencies":[]}