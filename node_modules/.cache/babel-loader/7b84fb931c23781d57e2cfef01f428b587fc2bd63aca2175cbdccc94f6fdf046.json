{"ast":null,"code":"import{useEffect,useCallback,useState}from\"react\";import axios from\"axios\";// dev\nconst CLIENT_ID_DEV='1b634143bf4693953f90';const CLIENT_SECRET_DEV='dd4891350db8ea4265143e5d3a140943965f1c76';// product\nconst CLIENT_ID='70b402fcf8bd7ec74c79';const CLIENT_SECRET='71562b257c5a7c0045bbce10a60118233736c562';export const useAuthentication=()=>{const[user,setUser]=useState();// \tconst user = useContext(useUser);\n// const {setUser}=UseUserContent()\nconst login=useCallback(()=>{const token=window.localStorage.getItem('token');if(token){console.log(token);axios.get('https://api.github.com/user',{headers:{'Authorization':'token '+token}}).then(e=>{if(e&&e.data){console.log(e);setUser({token:token,name:e.data.name});}}).catch(ex=>{window.alert('login failed');console.error(ex);window.localStorage.removeItem('token');});}else{console.log(process.env.NODE_ENV);window.location.href=\"https://github.com/login/oauth/authorize?client_id=\".concat(process.env.NODE_ENV==='production'?CLIENT_ID:CLIENT_ID_DEV,\"&scope=repo\");}},[]);useEffect(()=>{const code=/code=(\\w+)/[Symbol.match](window.location.href);if(code&&code[1]){console.log(process.env.NODE_ENV);console.log(code[1]);axios.post('https://github.com/login/oauth/access_token',{client_id:process.env.NODE_ENV==='production'?CLIENT_ID:CLIENT_ID_DEV,client_secret:process.env.NODE_ENV==='production'?CLIENT_SECRET:CLIENT_SECRET_DEV,code:code[1]},{headers:{\"X-GitHub-Api-Version\":\"2022-11-28\",\"Access-Control-Allow-Origin\":\"*\",\"Access-Control-Allow-Headers\":\"X-Requested-With\"}}).then(e=>{if(e.data){console.log(e.data);const token=/access_token=(\\w+)/[Symbol.match](e.data);if(token&&token[1]){window.localStorage.setItem('token',token[1]);window.location.href=window.location.href.replace(/[&?]code=\\w+/,'');}}}).catch(ex=>{// window.alert('login error')\nconsole.error(ex);});}},[]);return{user,login};};","map":{"version":3,"names":["useEffect","useCallback","useState","axios","CLIENT_ID_DEV","CLIENT_SECRET_DEV","CLIENT_ID","CLIENT_SECRET","useAuthentication","user","setUser","login","token","window","localStorage","getItem","console","log","get","headers","then","e","data","name","catch","ex","alert","error","removeItem","process","env","NODE_ENV","location","href","concat","code","Symbol","match","post","client_id","client_secret","setItem","replace"],"sources":["/Users/bytedance/projects/camp-tool/src/utils/auth.ts"],"sourcesContent":["import { useEffect, useCallback, useState } from \"react\";\nimport axios from \"axios\";\nimport { User } from \"./types\";\n\n// dev\nconst CLIENT_ID_DEV = '1b634143bf4693953f90';\nconst CLIENT_SECRET_DEV = 'dd4891350db8ea4265143e5d3a140943965f1c76';\n \n// product\nconst CLIENT_ID = '70b402fcf8bd7ec74c79';\nconst CLIENT_SECRET = '71562b257c5a7c0045bbce10a60118233736c562';\n\n\nexport const useAuthentication = () => {\n  const [user, setUser] = useState<User>();\n  // \tconst user = useContext(useUser);\n// const {setUser}=UseUserContent()\n\tconst login = useCallback(() => {\n        const token = window.localStorage.getItem('token');\n            if(token){\n                console.log(token)\n                axios.get('https://api.github.com/user', {\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t'Authorization': 'token ' + token\n\t\t\t\t\t}\n\t\t\t\t}).then((e:any) => {\n\t\t\t\t\tif (e && e.data) {\n                        console.log(e)\n\t\t\t\t\t\tsetUser({token:token,name:e.data.name});\n\t\t\t\t\t}\n\t\t\t\t}).catch((ex:any) => {\n\t\t\t\twindow.alert('login failed')\n\t\t\t\t\tconsole.error(ex);\n\t\t\t\t\twindow.localStorage.removeItem('token');\n\t\t\t\t})\n            }else{\n            console.log(process.env.NODE_ENV)\n            window.location.href = `https://github.com/login/oauth/authorize?client_id=${process.env.NODE_ENV==='production'?CLIENT_ID:CLIENT_ID_DEV}&scope=repo`;\n            }\n\t}, [])\n\n\tuseEffect(() => {\n            const code = /code=(\\w+)/[Symbol.match](window.location.href);\n\t\tif (code && code[1]) {\n            console.log(process.env.NODE_ENV)\n            console.log(code[1])\n                axios.post('https://github.com/login/oauth/access_token', {\n\t\t\t\tclient_id: process.env.NODE_ENV==='production'?CLIENT_ID:CLIENT_ID_DEV,\n\t\t\t\tclient_secret: process.env.NODE_ENV==='production'?CLIENT_SECRET:CLIENT_SECRET_DEV,\n\t\t\t\tcode: code[1]\n\t\t\t},\n            {\n                headers: {\n                  \"X-GitHub-Api-Version\": \"2022-11-28\",\n                  \"Access-Control-Allow-Origin\":\"*\",\n                  \"Access-Control-Allow-Headers\":\"X-Requested-With\"\n                },\n            }).then(e => {\n\t\t\t\tif (e.data) {\n                    console.log(e.data)\n\t\t\t\t\tconst token = /access_token=(\\w+)/[Symbol.match](e.data);\n\t\t\t\t\tif (token && token[1]) {\n\t\t\t\t\t\twindow.localStorage.setItem('token', token[1]);\n\t\t\t\t\t\twindow.location.href = window.location.href.replace(/[&?]code=\\w+/, '');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}).catch(ex => {\n\t\t\t\t// window.alert('login error')\n\t\t\t\tconsole.error(ex);\n\t\t\t})\n\t\t}\n\n\t}, []);\n\n\treturn {user,login};\n};"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}