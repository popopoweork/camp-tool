{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useCallback, useState } from \"react\";\nimport axios from \"axios\";\n// dev\nconst CLIENT_ID_DEV = '1b634143bf4693953f90';\nconst CLIENT_SECRET_DEV = 'dd4891350db8ea4265143e5d3a140943965f1c76';\n\n// product\nconst CLIENT_ID = '70b402fcf8bd7ec74c79';\nconst CLIENT_SECRET = '71562b257c5a7c0045bbce10a60118233736c562';\nexport const useAuthentication = () => {\n  _s();\n  const [user, setUser] = useState();\n  // \tconst user = useContext(useUser);\n  // const {setUser}=UseUserContent()\n  const login = useCallback(() => {\n    const token = window.localStorage.getItem('token');\n    if (token) {\n      console.log(token);\n      axios.get('https://api.github.com/user', {\n        headers: {\n          'Authorization': 'token ' + token\n        }\n      }).then(e => {\n        if (e && e.data) {\n          console.log(e);\n          setUser({\n            token: token,\n            name: e.data.name\n          });\n        }\n      }).catch(ex => {\n        window.alert('login failed');\n        console.error(ex);\n        window.localStorage.removeItem('token');\n      });\n    } else {\n      console.log(process.env.NODE_ENV);\n      window.location.href = `https://github.com/login/oauth/authorize?client_id=${process.env.NODE_ENV === 'production' ? CLIENT_ID : CLIENT_ID_DEV}&scope=repo`;\n    }\n  }, []);\n  useEffect(() => {\n    const code = /code=(\\w+)/[Symbol.match](window.location.href);\n    if (code && code[1]) {\n      console.log(process.env.NODE_ENV);\n      console.log(code[1]);\n      axios.post('https://github.com/login/oauth/access_token', {\n        client_id: process.env.NODE_ENV === 'production' ? CLIENT_ID : CLIENT_ID_DEV,\n        client_secret: process.env.NODE_ENV === 'production' ? CLIENT_SECRET : CLIENT_SECRET_DEV,\n        code: code[1]\n      }, {\n        headers: {\n          \"X-GitHub-Api-Version\": \"2022-11-28\",\n          \"Access-Control-Allow-Origin\": \"*\",\n          \"Access-Control-Allow-Headers\": \"X-Requested-With\"\n        }\n      }).then(e => {\n        if (e.data) {\n          console.log(e.data);\n          const token = /access_token=(\\w+)/[Symbol.match](e.data);\n          if (token && token[1]) {\n            window.localStorage.setItem('token', token[1]);\n            window.location.href = window.location.href.replace(/[&?]code=\\w+/, '');\n          }\n        }\n      }).catch(ex => {\n        // window.alert('login error')\n        console.error(ex);\n      });\n    }\n  }, []);\n  return {\n    user,\n    login\n  };\n};\n_s(useAuthentication, \"Vj07j4oux+6HW6GaaWIq22VtEts=\");","map":{"version":3,"names":["useEffect","useCallback","useState","axios","CLIENT_ID_DEV","CLIENT_SECRET_DEV","CLIENT_ID","CLIENT_SECRET","useAuthentication","_s","user","setUser","login","token","window","localStorage","getItem","console","log","get","headers","then","e","data","name","catch","ex","alert","error","removeItem","process","env","NODE_ENV","location","href","code","Symbol","match","post","client_id","client_secret","setItem","replace"],"sources":["/Users/bytedance/projects/camp-tool/src/utils/auth.ts"],"sourcesContent":["import { useEffect, useCallback, useState } from \"react\";\nimport axios from \"axios\";\nimport { User } from \"./types\";\n\n// dev\nconst CLIENT_ID_DEV = '1b634143bf4693953f90';\nconst CLIENT_SECRET_DEV = 'dd4891350db8ea4265143e5d3a140943965f1c76';\n \n// product\nconst CLIENT_ID = '70b402fcf8bd7ec74c79';\nconst CLIENT_SECRET = '71562b257c5a7c0045bbce10a60118233736c562';\n\n\nexport const useAuthentication = () => {\n  const [user, setUser] = useState<User>();\n  // \tconst user = useContext(useUser);\n// const {setUser}=UseUserContent()\n\tconst login = useCallback(() => {\n        const token = window.localStorage.getItem('token');\n            if(token){\n                console.log(token)\n                axios.get('https://api.github.com/user', {\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t'Authorization': 'token ' + token\n\t\t\t\t\t}\n\t\t\t\t}).then((e:any) => {\n\t\t\t\t\tif (e && e.data) {\n                        console.log(e)\n\t\t\t\t\t\tsetUser({token:token,name:e.data.name});\n\t\t\t\t\t}\n\t\t\t\t}).catch((ex:any) => {\n\t\t\t\twindow.alert('login failed')\n\t\t\t\t\tconsole.error(ex);\n\t\t\t\t\twindow.localStorage.removeItem('token');\n\t\t\t\t})\n            }else{\n            console.log(process.env.NODE_ENV)\n            window.location.href = `https://github.com/login/oauth/authorize?client_id=${process.env.NODE_ENV==='production'?CLIENT_ID:CLIENT_ID_DEV}&scope=repo`;\n            }\n\t}, [])\n\n\tuseEffect(() => {\n            const code = /code=(\\w+)/[Symbol.match](window.location.href);\n\t\tif (code && code[1]) {\n            console.log(process.env.NODE_ENV)\n            console.log(code[1])\n                axios.post('https://github.com/login/oauth/access_token', {\n\t\t\t\tclient_id: process.env.NODE_ENV==='production'?CLIENT_ID:CLIENT_ID_DEV,\n\t\t\t\tclient_secret: process.env.NODE_ENV==='production'?CLIENT_SECRET:CLIENT_SECRET_DEV,\n\t\t\t\tcode: code[1]\n\t\t\t},\n            {\n                headers: {\n                  \"X-GitHub-Api-Version\": \"2022-11-28\",\n                  \"Access-Control-Allow-Origin\":\"*\",\n                  \"Access-Control-Allow-Headers\":\"X-Requested-With\"\n                },\n            }).then(e => {\n\t\t\t\tif (e.data) {\n                    console.log(e.data)\n\t\t\t\t\tconst token = /access_token=(\\w+)/[Symbol.match](e.data);\n\t\t\t\t\tif (token && token[1]) {\n\t\t\t\t\t\twindow.localStorage.setItem('token', token[1]);\n\t\t\t\t\t\twindow.location.href = window.location.href.replace(/[&?]code=\\w+/, '');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}).catch(ex => {\n\t\t\t\t// window.alert('login error')\n\t\t\t\tconsole.error(ex);\n\t\t\t})\n\t\t}\n\n\t}, []);\n\n\treturn {user,login};\n};"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}